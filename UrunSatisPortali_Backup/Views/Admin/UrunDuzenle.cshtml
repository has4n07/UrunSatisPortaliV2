@model UrunSatisPortali.Models.Urun
@{
    ViewData["Title"] = "Ürün Düzenle";
}
<h1>Ürün Düzenle</h1>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="UrunDuzenle" method="post" enctype="multipart/form-data">

            <div asp-validation-summary="All" class="text-danger"></div>
            <input type="hidden" asp-for="Id" />
            <div class="form-group">
                <label asp-for="Ad" class="control-label"></label>
                <input asp-for="Ad" class="form-control" />
                <span asp-validation-for="Ad" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Fiyat" class="control-label"></label>
                <input asp-for="Fiyat" class="form-control" />
                <span asp-validation-for="Fiyat" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Stok" class="control-label"></label>
                <input asp-for="Stok" class="form-control" />
                <span asp-validation-for="Stok" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Aciklama" class="control-label"></label>
                <textarea asp-for="Aciklama" class="form-control"></textarea>
                <span asp-validation-for="Aciklama" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label class="control-label">Yeni Resimler Ekle</label>
                <input name="ResimDosyalari" class="form-control" type="file" multiple />
            </div>

            <div class="form-group mt-3">
                <div class="form-group mt-3">
                    <label>Mevcut Resimler:</label>
                    <div class="row">
                        @if (Model.UrunResimleri != null)
                        {
                            @foreach (var resim in Model.UrunResimleri)
                            {
                                <div class="col-md-4 text-center mb-2" id="resim-@resim.Id">
                                    <img src="@resim.ResimYolu" class="img-thumbnail" style="height: 100px;" />

                                    <button type="button" class="btn btn-danger btn-sm mt-1"
                                            onclick="silResim(@resim.Id, '@resim.ResimYolu')">
                                        Sil
                                    </button>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label asp-for="KategoriId" class="control-label"></label>
                <select asp-for="KategoriId" class="form-control" asp-items="@ViewBag.KategoriListesi">
                    <option value="0">-- Kategori Seçiniz --</option>
                </select>
                <span asp-validation-for="KategoriId" class="text-danger"></span>
            </div>
            <div class="form-group form-check mt-3">
                <input class="form-check-input" type="checkbox" asp-for="Aktif" />
                <label class="form-check-label" asp-for="Aktif"></label>
            </div>
            <br />
            <div class="form-group">
                <input type="submit" value="Kaydet" class="btn btn-primary" />
                <a asp-action="Urunler" class="btn btn-secondary">Listeye Geri Dön</a>
            </div>
        </form>
    </div>
</div>
@section Scripts {
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        var token = $('input[name="__RequestVerificationToken"]').val();

        // AJAX Silme İşlemini Yapan Fonksiyon
        function silResim(resimId, resimYolu) {
            if (!confirm("Bu resmi kalıcı olarak silmek istediğinizden emin misiniz?")) {
                return;
            }

            $.ajax({
                type: "POST",
                url: "/Admin/ResimSilAJAX",
                data: {
                    id: resimId,
                    "__RequestVerificationToken": token
                },
                dataType: "json",
                success: function (response) {
                    if (response.success) {
                        // Başarılıysa resmi ekrandan kaldır
                        $("#resim-" + resimId).remove();
                        alert(response.message);
                    } else {
                        alert(response.message);
                    }
                },
                error: function (xhr, status, error) {
                    alert("Beklenmedik bir hata oluştu: " + error);
                }
            });
        }
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    
}
    <partial name="_ValidationScriptsPartial" />
